# 集成测试

本目录包含Web-to-APK工具的集成测试，用于验证完整的工作流程和多种配置场景。

## 测试文件

### 1. build-scenarios.test.ts
测试多种配置场景的构建流程：

- **配置场景测试**：
  - 最小配置场景
  - 完整配置场景
  - React应用配置
  - Vue应用配置
  - PWA应用配置

- **APK功能验证**：
  - 权限验证
  - 应用信息验证
  - WebView配置验证
  - APK签名流程验证

- **错误场景处理**：
  - 无效包名配置
  - 缺失资源文件
  - 签名失败场景

### 2. performance-benchmarks.test.ts
性能基准测试：

- **构建性能测试**：
  - 小型项目构建时间
  - 中型项目构建时间
  - 大型项目构建时间

- **内存使用测试**：
  - 构建过程内存监控
  - 内存泄漏检测

- **并发处理测试**：
  - 并发构建请求处理
  - 资源优化性能
  - 构建缓存性能

### 3. full-workflow.test.ts
完整工作流程测试：

- **项目生命周期**：
  - 从初始化到构建的完整流程
  - React项目完整流程
  - 发布版本完整流程

- **错误恢复场景**：
  - 初始化错误恢复
  - 构建错误恢复

- **性能集成测试**：
  - 完整流程性能监控
  - 资源管理测试

## 运行测试

### 运行所有集成测试
```bash
npm test -- tests/integration/
```

### 运行特定测试文件
```bash
npm test -- tests/integration/build-scenarios.test.ts
npm test -- tests/integration/performance-benchmarks.test.ts
npm test -- tests/integration/full-workflow.test.ts
```

### 运行特定测试用例
```bash
npm test -- tests/integration/build-scenarios.test.ts --testNamePattern="应该处理最小配置场景"
```

## 测试配置

集成测试使用专门的Jest配置文件 `jest.config.js`，包含以下特性：

- **ESM支持**：支持ES模块语法
- **TypeScript支持**：使用ts-jest转换器
- **测试超时**：30秒超时时间
- **顺序执行**：使用单个worker避免并发问题
- **覆盖率报告**：生成详细的覆盖率报告

## 测试工具

### setup.ts
提供全局测试工具和性能监控工具：

- **testUtils**：创建mock配置的工具函数
- **performanceUtils**：性能测量工具

## 性能基准

### 构建时间基准
- 小型项目：< 1秒
- 中型项目：< 2秒
- 大型项目：< 3秒

### 内存使用基准
- 构建过程内存增长：< 50MB
- 无内存泄漏

### 并发处理基准
- 支持多个并发构建请求
- 并发构建比串行构建更快

## 测试覆盖的需求

这些集成测试覆盖了以下需求：

- **需求1.1**：基本的Web到APK转换功能
- **需求1.2**：支持多种Web应用框架
- **需求1.3**：配置文件支持和验证

## 注意事项

1. **Mock依赖**：所有外部依赖都被mock，确保测试的独立性
2. **性能测试**：性能测试的基准值可能需要根据实际硬件环境调整
3. **错误处理**：测试包含完整的错误处理和恢复场景
4. **资源管理**：验证资源文件的正确处理和优化

## 故障排除

### 测试超时
如果测试超时，可以增加Jest配置中的`testTimeout`值。

### 性能基准失败
性能基准可能因硬件环境而异，可以适当调整期望值。

### Mock问题
确保所有外部依赖都正确mock，避免实际的文件系统操作。